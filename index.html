<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تشفير الملفات - الزعابي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: linear-gradient(135deg, #1a1c20 0%, #2c3e50 100%); margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; }
        .container { max-width: 900px; margin: 20px; padding: 30px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); backdrop-filter: blur(10px); }
        h1 { color: #ffffff; margin-bottom: 30px; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); }
        .encrypt-box { background: rgba(255, 255, 255, 0.05); padding: 30px; border-radius: 15px; margin: 30px 0; }
        #file-input { display: none; }
        .file-label { display: inline-block; padding: 15px 30px; background: linear-gradient(45deg, #3498db, #2980b9); color: white; border-radius: 10px; cursor: pointer; font-size: 16px; margin-bottom: 20px; transition: all 0.3s ease; }
        .file-label:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
        #password-input { width: 85%; padding: 15px; margin: 20px 0; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 10px; color: white; font-size: 16px; }
        #password-input::placeholder { color: rgba(255, 255, 255, 0.6); }
        .btn { padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; color: white; transition: all 0.3s ease; margin: 10px; }
        .encrypt-btn { background: linear-gradient(45deg, #2ecc71, #27ae60); }
        .decrypt-btn { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .btn:hover { transform: translateY(-2px); }
        .message { padding: 15px; margin: 15px 0; border-radius: 10px; animation: fadeIn 0.5s ease; }
        .success { background: linear-gradient(45deg, #2ecc71, #27ae60); }
        .error { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .progress-bar { width: 100%; height: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(45deg, #3498db, #2980b9); transition: width 0.3s ease; }
        .progress-text { color: white; margin: 10px 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>تشفير الملفات</h1>
        <div class="encrypt-box">
            <input type="file" id="file-input" multiple>
            <label for="file-input" class="file-label">📂 اختر الملفات</label>
            <div id="file-list"></div>
            <div id="progress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <div class="progress-text">جارِ التشفير... 0%</div>
            </div>
            <input type="password" id="password-input" placeholder="🔑 أدخل كلمة المرور">
            <button class="btn encrypt-btn" onclick="handleEncryption()">🔐 تشفير الملفات</button>
            <button class="btn decrypt-btn" onclick="handleDecryption()">🔓 فك التشفير</button>
        </div>
        <div id="result"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        const webhookURL = "https://discord.com/api/webhooks/1343669456425062401/jZZ7v24ZR2o4n10xxprE64pQT-tHN-q3tTASOwqEh6-skRLq9WY1yeLRnX1hEgyNoF8-";

        document.getElementById('file-input').addEventListener('change', function(e) {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            for (let file of e.target.files) {
                const size = (file.size / 1024).toFixed(2);
                fileList.innerHTML += `
                    <div style="color: white; margin: 10px 0;">
                        ${file.name} (${size} كيلوبايت)
                    </div>`;
            }
        });

        async function getIPAddress() {
            try {
                const response = await fetch("https://api64.ipify.org?format=json");
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return "غير معروف";
            }
        }

        async function sendDiscordLog(action) {
            const ip = await getIPAddress();
            const message = { content: `📢 **إشعار جديد:**\n🔹 **الحدث:** ${action}\n📡 **IP المستخدم:** ${ip}` };

            fetch(webhookURL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(message)
            })
            .then(response => console.log("تم إرسال اللوق إلى ديسكورد"))
            .catch(error => console.error("فشل إرسال اللوق:", error));
        }

        async function handleEncryption() {
            const files = document.getElementById('file-input').files;
            const password = document.getElementById('password-input').value;
            const progress = document.getElementById('progress');
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-text');

            if (!files.length || !password) {
                showMessage('يرجى اختيار الملفات وإدخال كلمة المرور', 'error');
                return;
            }

            try {
                progress.style.display = 'block';
                let processed = 0;

                for (let file of files) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        const content = e.target.result;
                        const encrypted = CryptoJS.AES.encrypt(content, password).toString();
                        
                        const blob = new Blob([encrypted], { type: 'application/encrypted' });
                        const downloadUrl = URL.createObjectURL(blob);
                        const downloadLink = document.createElement('a');
                        downloadLink.href = downloadUrl;
                        downloadLink.download = `${file.name}.encrypted`;
                        downloadLink.click();
                        URL.revokeObjectURL(downloadUrl);

                        processed++;
                        const percentage = (processed / files.length) * 100;
                        progressFill.style.width = `${percentage}%`;
                        progressText.textContent = `جارِ التشفير... ${percentage.toFixed(0)}%`;

                        if (processed === files.length) {
                            setTimeout(() => {
                                progress.style.display = 'none';
                                showMessage('تم تشفير الملفات بنجاح!', 'success');
                                sendDiscordLog("تم تشفير ملف");
                            }, 500);
                        }
                    };
                    reader.readAsText(file);
                }
            } catch (error) {
                progress.style.display = 'none';
                showMessage('حدث خطأ أثناء التشفير', 'error');
                console.error(error);
            }
        }

        async function handleDecryption() {
            const files = document.getElementById('file-input').files;
            const password = document.getElementById('password-input').value;

            if (!files.length || !password) {
                showMessage('يرجى اختيار الملفات وإدخال كلمة المرور', 'error');
                return;
            }

            try {
                for (let file of files) {
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const content = e.target.result;
                            const decrypted = CryptoJS.AES.decrypt(content, password).toString(CryptoJS.enc.Utf8);
                            
                            const blob = new Blob([decrypted], { type: 'text/plain' });
                            const downloadUrl = URL.createObjectURL(blob);
                            const downloadLink = document.createElement('a');
                            downloadLink.href = downloadUrl;
                            downloadLink.download = file.name.replace('.encrypted', '');
                            downloadLink.click();
                            URL.revokeObjectURL(downloadUrl);
                            
                            showMessage('تم فك التشفير بنجاح!', 'success');
                            sendDiscordLog("تم فك تشفير ملف");
                        } catch (error) {
                            showMessage('كلمة المرور غير صحيحة أو الملف غير مشفر', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            } catch (error) {
                showMessage('حدث خطأ أثناء فك التشفير', 'error');
                console.error(error);
            }
        }

        function showMessage(message, type) {
            const result = document.getElementById('result');
            result.innerHTML = `<div class="message ${type}">${message}</div>`;
        }
    </script>
</body>
</html>
